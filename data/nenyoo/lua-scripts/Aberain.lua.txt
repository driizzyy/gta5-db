-- MoneyRain script for GTA 5 singleplayer
-- Drops money bags near the player, 1M each, toggle on/off with a button
local MoneyRain = {}

-- Settings
local isRainingMoney = false
local dropDelay = 4000 -- Drops every 4 secs (4000ms)
local lastDrop = 0
local cashPerBag = 1000000 -- 1 million bucks per bag

-- Spawns a single money bag
function MoneyRain.dropCash()
    local player = PLAYER.PLAYER_PED_ID()
    if not ENTITY.DOES_ENTITY_EXIST(player) then return end

    local pos = ENTITY.GET_ENTITY_COORDS(player, true)
    local cashModel = util.joaat("prop_cash_pile_01") -- Using a cash pile model

    -- Load the model
   _STREAMING.REQUEST_MODEL(cashModel)
    while not STREAMING.HAS_MODEL_LOADED(cashModel) do
        WAIT(0)
    end

    -- Spawn it a bit above and around the player
    local randX = math.random(-2, 2) -- Random spread
    local randY = math.random(1, 3)  -- Slightly in front
    local cashBag = OBJECT.CREATE_OBJECT(cashModel, pos.x + randX, pos.y + randY, pos.z + 2.0, true, true, false)

    -- Make it fall naturally
    ENTITY.APPLY_FORCE_TO_ENTITY(cashBag, 1, 0.0, 0.0, -10.0, 0.0, 0.0, 0.0, 0, true, false, true, false, false)
    ENTITY.SET_ENTITY_COLLISION(cashBag, true, true)

    -- Show a notification
    UI.NOTIFY_ABOVE_MAP("~g~$" .. cashPerBag .. " dropped!", "Money Rain", 0, true)

    -- Free the model
    STREAMING.SET_MODEL_AS_NO_LONGER_NEEDED(cashModel)

    -- Clean up the bag after 10 secs to avoid lag
    script.queue(function()
        WAIT(10000)
        if ENTITY.DOES_ENTITY_EXIST(cashBag) then
            ENTITY.DELETE_ENTITY(cashBag)
        end
    end)
end

-- Main loop to handle the dropping
function MoneyRain.tick()
    if not isRainingMoney then return end

    local now = util.currentTimeMillis()
    if now - lastDrop >= dropDelay then
        MoneyRain.dropCash()
        lastDrop = now
    end
end

-- Set up the menu with a single toggle button
gui.createMainTab("~g~Money Rain")

gui.createSubTab("Cash Drop", 0)
gui.addButton("Toggle Money Rain", "Click to enable/disable money rain (1M per bag).", function()
    isRainingMoney = not isRainingMoney
    if isRainingMoney then
        gui.pushNotification("Money Rain", "Enabled")
        lastDrop = util.currentTimeMillis() - dropDelay -- Start right away
    else
        gui.pushNotification("Money Rain", "Disabled")
    end
end)

-- Hook the script
script.addScript(MoneyRain.tick)

return MoneyRain